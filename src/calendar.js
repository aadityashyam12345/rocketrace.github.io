"use strict";function loadFile(e){var a=new XMLHttpRequest;return a.open("GET",e,!1),a.send(),200==a.status?a.response:(console.log("Failed to GET content of "+e),null)}function dayKey(e){return e.weekDay+"-"+e.rotationDay}function bridgeDay(e,a){var n=e.split(","),t=a.indexOf(n[0]),r=e[1].split("/");return{rotationDay:t,weekDay:new Date(Number(r[2]),Number(r[0])-1,Number(r[1])).getDay()}}var Lesson=function(){this.id="",this.label="",this.startTime=new Date(0),this.endTime=new Date(0)};function makeIcal(e){var a=[];a.push("BEGIN:VCALENDAR"),a.push("VERSION:2.0"),a.push("PRODID:-//RocketRace//CA Calendar Generator//EN"),a.push("X-WR-CALNAME:Lesson Rotation");var n=0,t=new Date;return e.forEach(function(e){a.push(makeEventIcal(e,t,n)),n+=1}),a.push("END:VCALENDAR"),a.join("\r\n")}function makeEventIcal(e,a,n){var t=[];return t.push("BEGIN:VEVENT"),t.push("UID:"+a.toISOString()+"_"+n+"@rocketrace.github.io"),t.push("DTSTAMP:"+a.toISOString()),t.push("DTSTART:"+e.startTime.toISOString()),t.push("DTEND:"+e.endTime.toISOString()),t.push("SUMMARY:"+e.label),t.push("CATEGORIES:Period "+e.id),t.push("END:VEVENT"),t.join("\r\n")}function makeCalendar(t){var e=loadFile("/src/data/calendar.csv"),a=loadFile("/src/data/times.json"),n=loadFile("/src/data/rotation.json");if(null===e||null===a||null===n)return alert("Could not load the calendar data! Try again later."),null;var r=e.substring(e.indexOf("\n")+1).split("\n"),o=JSON.parse(a),i=JSON.parse(n),s=[],l={};r.forEach(function(e){var a=dayKey(bridgeDay(e,i.days));if(void 0===l[a])for(var n=0;n<i[t].length;n++)i[t][n],o[t][n],new Lesson;else s.concat(l[a])});makeIcal(s);return null}makeCalendar("dp");