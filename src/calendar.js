"use strict";function _classCallCheck(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}function loadFile(t){var a=new XMLHttpRequest;return a.open("GET",t,!1),a.send(),200==a.status?a.response:(console.log("Failed to GET content of ".concat(t)),null)}function leftPad(t,a,e){if(t.length>=e)return t;for(var n=e-t.length,o=[],r=0;r<n;r++)o.push(a);return o.push(t),o.join("")}function fmtDate(t){var a=t.getFullYear(),e=t.getMonth()+1,n=t.getDate(),o=t.getHours(),r=t.getMinutes(),s=t.getSeconds(),c=leftPad(e.toString(),"0",2),l=leftPad(n.toString(),"0",2),i=leftPad(o.toString(),"0",2),u=leftPad(r.toString(),"0",2),d=leftPad(s.toString(),"0",2);return"".concat(a).concat(c).concat(l,"T").concat(i).concat(u).concat(d,"Z")}function dayKey(t){return"".concat(t.weekDay,"-").concat(t.rotationDay)}function bridgeDay(t,a){var e=t.split(","),n=a.indexOf(e[0].substring(1,e[0].length-1)),o=e[1].substring(1,e[1].length-1).split("/"),r=new Date(Number(o[2]),Number(o[0])-1,Number(o[1]));return{rotationDay:n,weekDay:r.getDay()-1,date:r}}var Lesson=function t(a,e,n,o){_classCallCheck(this,t),this.id=a,this.label=e,this.startTime=n,this.endTime=o};function makeIcal(t){var a=[];a.push("BEGIN:VCALENDAR"),a.push("VERSION:2.0"),a.push("PRODID:-//RocketRace//CA Calendar Generator//EN"),a.push("X-WR-CALNAME:Lesson Rotation");var e=0,n=fmtDate(new Date);return t.forEach(function(t){a.push(makeEventIcal(t,n,e)),e+=1}),a.push("END:VCALENDAR"),a.join("\r\n")}function makeEventIcal(t,a,e){var n=[];return n.push("BEGIN:VEVENT"),n.push("UID:".concat(a,"_").concat(e,"@rocketrace.github.io")),n.push("DTSTAMP:".concat(a)),n.push("DTSTART:".concat(fmtDate(t.startTime))),n.push("DTEND:".concat(fmtDate(t.endTime))),n.push("SUMMARY:".concat(t.label)),n.push("CATEGORIES:Period ".concat(t.id)),n.push("END:VEVENT"),n.join("\r\n")}function makeCalendar(i,u){var t=loadFile("/src/data/calendar.csv"),a=loadFile("/src/data/times.json"),e=loadFile("/src/data/rotation.json");if(null===t||null===a||null===e)return alert("Could not load the calendar data! Try again later."),null;var n=t.substring(t.indexOf("\n")+1).split("\n"),d=JSON.parse(a),f=JSON.parse(e),h=[],p={};n.forEach(function(t){var a=bridgeDay(t,f.days),e=dayKey(a);if(void 0===p[e])for(var n=0;n<f[i][a.rotationDay].length;n++){var o=f[i][a.rotationDay][n],r=d[i][a.weekDay][n],s=a.date,c=a.date;s.setHours(r.startHours),s.setMinutes(r.startMinutes),c.setHours(r.endHours),c.setMinutes(r.endMinutes);var l="",l=o.special?o.label:u[o.id];h.push(new Lesson(o.id,l,s,c))}else h.concat(p[e])});var o=makeIcal(h);return console.log("Generated iCal calendar contents."),console.log(o),null}function downloadCalendar(t,a){Array.from("")}var choices={test:"My Lesson Is Called Test",2:"AAAA",3:"AA",4:"A",5:"AWAA",6:"AAAa",7:"a"};makeCalendar("dp",choices);