"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function loadFile(t){var e=new XMLHttpRequest;return e.open("GET",t,!1),e.send(),200==e.status?e.response:(console.log("Failed to GET content of ".concat(t)),null)}function leftPad(t,e,n){if(t.length>=n)return t;for(var a=n-t.length,o=[],r=0;r<a;r++)o.push(e);return o.push(t),o.join("")}function fmtDate(t){var e=t.getFullYear(),n=t.getMonth()+1,a=t.getDate(),o=t.getHours(),r=t.getMinutes(),s=t.getSeconds(),c=leftPad(n.toString(),"0",2),l=leftPad(a.toString(),"0",2),i=leftPad(o.toString(),"0",2),u=leftPad(r.toString(),"0",2),d=leftPad(s.toString(),"0",2);return"".concat(e).concat(c).concat(l,"T").concat(i).concat(u).concat(d,"Z")}function dayKey(t){return"".concat(t.weekDay,"-").concat(t.rotationDay)}function bridgeDay(t,e){var n=t.split(","),a=e.indexOf(n[0].substring(1,n[0].length-1)),o=n[1].substring(1,n[1].length-1).split("/"),r=new Date(Number(o[2]),Number(o[0])-1,Number(o[1]));return{rotationDay:a,weekDay:r.getDay()-1,date:r}}var Lesson=function t(e,n,a,o){_classCallCheck(this,t),this.id=e,this.label=n,this.startTime=a,this.endTime=o};function makeIcal(t){var e=[];e.push("BEGIN:VCALENDAR"),e.push("VERSION:2.0"),e.push("PRODID:-//RocketRace//CA Calendar Generator//EN"),e.push("X-WR-CALNAME:Lesson Rotation");var n=0,a=fmtDate(new Date);return t.forEach(function(t){e.push(makeEventIcal(t,a,n)),n+=1}),e.push("END:VCALENDAR"),e.join("\r\n")}function makeEventIcal(t,e,n){var a=[];return a.push("BEGIN:VEVENT"),a.push("UID:".concat(e,"_").concat(n,"@rocketrace.github.io")),a.push("DTSTAMP:".concat(e)),a.push("DTSTART:".concat(fmtDate(t.startTime))),a.push("DTEND:".concat(fmtDate(t.endTime))),a.push("SUMMARY:".concat(t.label)),a.push("CATEGORIES:Period ".concat(t.id)),a.push("END:VEVENT"),a.join("\r\n")}function makeCalendar(i,u){var t=loadFile("/src/data/calendar.csv"),e=loadFile("/src/data/times.json"),n=loadFile("/src/data/rotation.json");if(null===t||null===e||null===n)return alert("Could not load the calendar data! Try again later."),null;var a=t.substring(t.indexOf("\n")+1).split("\n"),d=JSON.parse(e),h=JSON.parse(n),f=[],p={};a.forEach(function(t){var e=bridgeDay(t,h.days),n=dayKey(e);if(void 0===p[n])for(var a=0;a<h[i][e.rotationDay].length;a++){var o=h[i][e.rotationDay][a],r=d[i][e.weekDay][a],s=e.date,c=e.date;s.setHours(r.startHours),s.setMinutes(r.startMinutes),c.setHours(r.endHours),c.setMinutes(r.endMinutes);var l="",l=o.special?o.label:u[o.id];f.push(new Lesson(o.id,l,s,c))}else f.concat(p[n])});var o=makeIcal(f);return console.log("Generated iCal calendar contents."),console.log(o),saveResult(o),o}function saveResult(t){var e=document.getElementById("calendar-result");null!==e?e.innerHTML=t:console.log("Could not find div with id 'calendar-result'")}function download(t,e){var n=document.createElement("a");n.setAttribute("href","data:text/ics;charset=utf-8,"+encodeURIComponent(e)),n.setAttribute("download",t),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}var choices={test:"My Lesson Is Called Test",2:"AAAA",3:"AA",4:"A",5:"AWAA",6:"AAAa",7:"a"};function init(){var t=makeCalendar("dp",choices);null!==t&&download("calendar.ics",t)}window.onload=init;